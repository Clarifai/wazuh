;   Copyright (C) 2015-2021, Wazuh Inc.
;
;   Tests for products:
;     Sysmon event Id 13
;

;[Sysmon event 13: Added registry content to be executed on next logon]
;log 1 pass = {"win":{"eventdata":{"image":"C:\\\\Windows\\\\system32\\\\msi.exe","targetObject":"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Java-Update","processGuid":"{4dc16835-4977-60ef-dac9-5b0000000000}","processId":"4692","utcTime":"2021-07-14 20:30:47.841","ruleName":"technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder","details":"C:\\\\Users\\\\Public\\\\Java-Update","eventType":"SetValue"},"system":{"eventID":"13","keywords":"0x8000000000000000","providerGuid":"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}","level":"4","channel":"Microsoft-Windows-Sysmon/Operational","opcode":"0","message":"\"Registry value set:\r\nRuleName: technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder\r\nEventType: SetValue\r\nUtcTime: 2021-07-14 20:30:47.841\r\nProcessGuid: {4dc16835-4977-60ef-dac9-5b0000000000}\r\nProcessId: 4692\r\nImage: C:\\Windows\\system32\\reg.exe\r\nTargetObject: HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Java-Update\r\nDetails: C:\\Users\\Public\\\"","version":"2","systemTime":"2021-07-14T20:30:47.8486552Z","eventRecordID":"28692","threadID":"1272","computer":"cfo.ExchangeTest.com","task":"13","processID":"5364","severityValue":"INFORMATION","providerName":"Microsoft-Windows-Sysmon"}}}
;rule = 92300
;alert = 0
;decoder = json
;
;[Sysmon event 13: Suspicious file extension detected in registry ASEP]
;log 1 pass = {"win":{"eventdata":{"image":"C:\\\\Windows\\\\system32\\\\reg.exe","targetObject":"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Java-Update","processGuid":"{4dc16835-4977-60ef-dac9-5b0000000000}","processId":"4692","utcTime":"2021-07-14 20:30:47.841","ruleName":"technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder","details":"C:\\\\Users\\\\Public\\\\Java-Update.vbs","eventType":"SetValue"},"system":{"eventID":"13","keywords":"0x8000000000000000","providerGuid":"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}","level":"4","channel":"Microsoft-Windows-Sysmon/Operational","opcode":"0","message":"\"Registry value set:\r\nRuleName: technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder\r\nEventType: SetValue\r\nUtcTime: 2021-07-14 20:30:47.841\r\nProcessGuid: {4dc16835-4977-60ef-dac9-5b0000000000}\r\nProcessId: 4692\r\nImage: C:\\Windows\\system32\\reg.exe\r\nTargetObject: HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Java-Update\r\nDetails: C:\\Users\\Public\\Java-Update.vbs\"","version":"2","systemTime":"2021-07-14T20:30:47.8486552Z","eventRecordID":"28692","threadID":"1272","computer":"cfo.ExchangeTest.com","task":"13","processID":"5364","severityValue":"INFORMATION","providerName":"Microsoft-Windows-Sysmon"}}}
;rule = 92301
;alert = 12
;decoder = json
;
;[Sysmon event 13: Registry entry to be executed on next logon was modified using command line application reg.exe]
;log 1 pass = {"win":{"eventdata":{"image":"C:\\\\Windows\\\\system32\\\\reg.exe","targetObject":"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Java-Update","processGuid":"{4dc16835-4977-60ef-dac9-5b0000000000}","processId":"4692","utcTime":"2021-07-14 20:30:47.841","ruleName":"technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder","details":"C:\\\\Users\\\\Public\\\\Java-Update","eventType":"SetValue"},"system":{"eventID":"13","keywords":"0x8000000000000000","providerGuid":"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}","level":"4","channel":"Microsoft-Windows-Sysmon/Operational","opcode":"0","message":"\"Registry value set:\r\nRuleName: technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder\r\nEventType: SetValue\r\nUtcTime: 2021-07-14 20:30:47.841\r\nProcessGuid: {4dc16835-4977-60ef-dac9-5b0000000000}\r\nProcessId: 4692\r\nImage: C:\\Windows\\system32\\reg.exe\r\nTargetObject: HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Java-Update\r\nDetails: C:\\Users\\Public\\Java-Update.vbs\"","version":"2","systemTime":"2021-07-14T20:30:47.8486552Z","eventRecordID":"28692","threadID":"1272","computer":"cfo.ExchangeTest.com","task":"13","processID":"5364","severityValue":"INFORMATION","providerName":"Microsoft-Windows-Sysmon"}}}
;rule = 92302
;alert = 6
;decoder = json